{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "array",
  "title": "ArrayField",
  "description": "A repeatable array field for BuzzForm. Supports nested fields, drag-and-drop reordering, add/duplicate/remove items, minRows/maxRows constraints, collapsible rows, and error badges per row.",
  "dependencies": [
    "@buildnbuzz/buzzform",
    "@dnd-kit/core",
    "@dnd-kit/sortable",
    "@dnd-kit/utilities"
  ],
  "registryDependencies": [
    "@buzzform/init",
    "card",
    "collapsible",
    "badge",
    "button",
    "skeleton",
    "alert-dialog"
  ],
  "files": [
    {
      "path": "registry/base/fields/array.tsx",
      "content": "\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport type {\r\n  ArrayField as ArrayFieldType,\r\n  FormAdapter,\r\n} from \"@buildnbuzz/buzzform\";\r\nimport {\r\n  getNestedFieldPaths,\r\n  countNestedErrors,\r\n  getArrayRowLabel,\r\n} from \"@buildnbuzz/buzzform\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { FieldRenderer, type FieldRegistry } from \"./render\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport {\r\n  Collapsible,\r\n  CollapsibleContent,\r\n  CollapsibleTrigger,\r\n} from \"@/components/ui/collapsible\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { IconPlaceholder } from \"@/components/icon-placeholder\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogMedia,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport {\r\n  DndContext,\r\n  closestCenter,\r\n  KeyboardSensor,\r\n  PointerSensor,\r\n  useSensor,\r\n  useSensors,\r\n  type DragEndEvent,\r\n} from \"@dnd-kit/core\";\r\nimport {\r\n  SortableContext,\r\n  sortableKeyboardCoordinates,\r\n  verticalListSortingStrategy,\r\n  useSortable,\r\n} from \"@dnd-kit/sortable\";\r\nimport { CSS } from \"@dnd-kit/utilities\";\r\n\r\n// =============================================================================\r\n// TYPES\r\n// =============================================================================\r\n\r\nexport interface ArrayFieldComponentProps {\r\n  field: ArrayFieldType;\r\n  path: string;\r\n  form: FormAdapter;\r\n  registry?: FieldRegistry;\r\n  autoFocus?: boolean;\r\n  formValues: Record<string, unknown>;\r\n  siblingData: Record<string, unknown>;\r\n  // Computed props\r\n  fieldId: string;\r\n  label: React.ReactNode | null;\r\n  isDisabled: boolean;\r\n  isReadOnly: boolean;\r\n  error?: string;\r\n}\r\n\r\ninterface ArrayRowItem {\r\n  id: string;\r\n  [key: string]: unknown;\r\n}\r\n\r\ninterface ArrayRowProps {\r\n  id: string;\r\n  index: number;\r\n  field: ArrayFieldType;\r\n  path: string;\r\n  form: FormAdapter;\r\n  registry?: FieldRegistry;\r\n  onRemove: (index: number) => void;\r\n  onDuplicate: (index: number) => void;\r\n  isOpen: boolean;\r\n  onToggle: (index: number) => void;\r\n  canRemove: boolean;\r\n  canDuplicate: boolean;\r\n  isSortable: boolean;\r\n  isDisabled: boolean;\r\n  isReadOnly: boolean;\r\n  isNew?: boolean; // For animation on new rows\r\n  isExiting?: boolean; // For animation on removing rows\r\n}\r\n\r\n// =============================================================================\r\n// HOOKS\r\n// =============================================================================\r\n\r\n/**\r\n * Hook to count errors in nested fields for a row.\r\n */\r\nconst useNestedErrors = (\r\n  form: FormAdapter,\r\n  fields: ArrayFieldType[\"fields\"],\r\n  basePath: string\r\n): number => {\r\n  const errors = form.formState.errors;\r\n  const nestedPaths = getNestedFieldPaths(fields, basePath);\r\n  return nestedPaths.filter((p) => errors[p]).length;\r\n};\r\n\r\n/**\r\n * Hook to count total errors across all array rows.\r\n */\r\nconst useArrayErrors = (\r\n  form: FormAdapter,\r\n  fields: ArrayFieldType[\"fields\"],\r\n  path: string,\r\n  rowCount: number\r\n): number => {\r\n  const errors = form.formState.errors;\r\n  let totalErrors = 0;\r\n  for (let i = 0; i < rowCount; i++) {\r\n    const rowPath = `${path}.${i}`;\r\n    totalErrors += countNestedErrors(errors, fields, rowPath);\r\n  }\r\n  return totalErrors;\r\n};\r\n\r\n// ARRAY ROW (Memoized)\r\n// =============================================================================\r\n\r\nconst ArrayRow = React.memo(\r\n  ({\r\n    id,\r\n    index,\r\n    field,\r\n    path,\r\n    form,\r\n    registry,\r\n    onRemove,\r\n    onDuplicate,\r\n    isOpen,\r\n    onToggle,\r\n    canRemove,\r\n    canDuplicate,\r\n    isSortable,\r\n    isDisabled,\r\n    isReadOnly,\r\n    isNew = false,\r\n    isExiting = false,\r\n  }: ArrayRowProps) => {\r\n    const rowRef = React.useRef<HTMLDivElement>(null);\r\n    const {\r\n      attributes,\r\n      listeners,\r\n      setNodeRef,\r\n      transform,\r\n      transition,\r\n      isDragging,\r\n    } = useSortable({ id, disabled: !isSortable || isDisabled || isReadOnly });\r\n\r\n    const style: React.CSSProperties = {\r\n      transform: CSS.Transform.toString(transform),\r\n      transition,\r\n      opacity: isDragging ? 0.5 : 1,\r\n    };\r\n\r\n    const rowPath = `${path}.${index}`;\r\n    const rowData = form.watch<Record<string, unknown>>(rowPath);\r\n\r\n    // Use shared utility for row label\r\n    const rowLabel = getArrayRowLabel(\r\n      rowData,\r\n      field.fields,\r\n      field.ui as { rowLabelField?: string } | undefined,\r\n      `Item ${index + 1}`\r\n    );\r\n\r\n    const errorCount = useNestedErrors(form, field.fields, rowPath);\r\n\r\n    const handleRemoveClick = (e: React.MouseEvent) => {\r\n      e.stopPropagation();\r\n      if (canRemove && !isDisabled && !isReadOnly) {\r\n        onRemove(index);\r\n      }\r\n    };\r\n\r\n    const handleDuplicateClick = (e: React.MouseEvent) => {\r\n      e.stopPropagation();\r\n      if (canDuplicate && !isDisabled && !isReadOnly) {\r\n        onDuplicate(index);\r\n      }\r\n    };\r\n\r\n    const handleToggleClick = () => {\r\n      onToggle(index);\r\n    };\r\n\r\n    // Focus first focusable element when row is new and open\r\n    React.useEffect(() => {\r\n      if (isNew && isOpen && rowRef.current) {\r\n        // Delay to allow content to render\r\n        const timer = setTimeout(() => {\r\n          const firstInput = rowRef.current?.querySelector<HTMLElement>(\r\n            'input:not([type=\"hidden\"]), textarea, select, [contenteditable=\"true\"], button[data-focusable]'\r\n          );\r\n          firstInput?.focus();\r\n        }, 100);\r\n        return () => clearTimeout(timer);\r\n      }\r\n    }, [isNew, isOpen]);\r\n\r\n    return (\r\n      <Collapsible open={isOpen} onOpenChange={handleToggleClick}>\r\n        <div\r\n          ref={(node) => {\r\n            setNodeRef(node);\r\n            (rowRef as React.MutableRefObject<HTMLDivElement | null>).current =\r\n              node;\r\n          }}\r\n          role=\"listitem\"\r\n          aria-label={`${rowLabel}, item ${index + 1}`}\r\n          style={style}\r\n          className={cn(\r\n            \"bg-card border rounded-lg overflow-hidden\",\r\n            isDragging && \"shadow-lg ring-2 ring-primary/20\",\r\n            isDisabled && \"opacity-60 pointer-events-none\",\r\n            isNew &&\r\n              \"animate-in fade-in-0 zoom-in-95 slide-in-from-top-2 duration-700\",\r\n            isExiting &&\r\n              \"animate-out fade-out-0 zoom-out-95 slide-out-to-top-2 duration-300 pointer-events-none\"\r\n          )}\r\n        >\r\n          <CardHeader\r\n            className={cn(\r\n              \"flex flex-row items-center gap-3 px-4 py-2 bg-muted/50 transition-colors shrink-0 rounded-t-lg\",\r\n              !isDisabled && \"hover:bg-muted/75\",\r\n              isOpen && \"border-b\"\r\n            )}\r\n          >\r\n            {isSortable && !isDisabled && !isReadOnly && (\r\n              <div\r\n                {...attributes}\r\n                {...listeners}\r\n                className=\"cursor-grab active:cursor-grabbing text-muted-foreground hover:text-foreground transition-colors shrink-0\"\r\n                title=\"Drag to reorder\"\r\n              >\r\n                <IconPlaceholder\r\n                  lucide=\"GripVertical\"\r\n                  hugeicons=\"DragDropIcon\"\r\n                  tabler=\"IconGripVertical\"\r\n                  phosphor=\"DotsSixVertical\"\r\n                  remixicon=\"RiDraggable\"\r\n                  className=\"size-4\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            <CollapsibleTrigger className=\"flex items-center gap-2 flex-1 text-left min-w-0 font-medium text-sm text-muted-foreground cursor-pointer\">\r\n              <IconPlaceholder\r\n                lucide=\"ChevronDown\"\r\n                hugeicons=\"ArrowDown01Icon\"\r\n                tabler=\"IconChevronDown\"\r\n                phosphor=\"CaretDown\"\r\n                remixicon=\"RiArrowDownSLine\"\r\n                className={cn(\r\n                  \"size-4 text-muted-foreground transition-transform duration-200 shrink-0\",\r\n                  !isOpen && \"-rotate-90\"\r\n                )}\r\n              />\r\n              <span className=\"truncate\">{rowLabel}</span>\r\n              {errorCount > 0 && (\r\n                <Badge\r\n                  variant=\"destructive\"\r\n                  className=\"h-5 px-1.5 text-xs ml-1\"\r\n                >\r\n                  {errorCount}\r\n                </Badge>\r\n              )}\r\n            </CollapsibleTrigger>\r\n\r\n            {!isReadOnly && (\r\n              <div className=\"flex items-center gap-1 shrink-0\">\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"icon\"\r\n                  className={cn(\r\n                    \"h-7 w-7 active:scale-95 transition-all\",\r\n                    (!canDuplicate || isDisabled) &&\r\n                      \"opacity-50 cursor-not-allowed\"\r\n                  )}\r\n                  onClick={handleDuplicateClick}\r\n                  disabled={!canDuplicate || isDisabled}\r\n                  title={\r\n                    canDuplicate\r\n                      ? \"Duplicate item\"\r\n                      : `Maximum ${field.maxRows} items reached`\r\n                  }\r\n                  aria-label={\r\n                    canDuplicate\r\n                      ? \"Duplicate item\"\r\n                      : `Maximum ${field.maxRows} items reached`\r\n                  }\r\n                >\r\n                  <IconPlaceholder\r\n                    lucide=\"Copy\"\r\n                    hugeicons=\"Copy01Icon\"\r\n                    tabler=\"IconCopy\"\r\n                    phosphor=\"Copy\"\r\n                    remixicon=\"RiFileCopyLine\"\r\n                    className=\"size-3.5\"\r\n                  />\r\n                </Button>\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"icon\"\r\n                  className={cn(\r\n                    \"h-7 w-7 text-destructive hover:bg-destructive/10 active:scale-95 transition-all\",\r\n                    (!canRemove || isDisabled) &&\r\n                      \"opacity-50 cursor-not-allowed\"\r\n                  )}\r\n                  disabled={!canRemove || isDisabled}\r\n                  onClick={handleRemoveClick}\r\n                  title={\r\n                    canRemove\r\n                      ? \"Delete item\"\r\n                      : `Minimum ${field.minRows} ${field.minRows === 1 ? \"item\" : \"items\"} required`\r\n                  }\r\n                  aria-label={\r\n                    canRemove\r\n                      ? \"Delete item\"\r\n                      : `Minimum ${field.minRows} items required`\r\n                  }\r\n                >\r\n                  <IconPlaceholder\r\n                    lucide=\"Trash2\"\r\n                    hugeicons=\"Delete02Icon\"\r\n                    tabler=\"IconTrash\"\r\n                    phosphor=\"Trash\"\r\n                    remixicon=\"RiDeleteBinLine\"\r\n                    className=\"size-3.5\"\r\n                  />\r\n                </Button>\r\n              </div>\r\n            )}\r\n          </CardHeader>\r\n\r\n          <CollapsibleContent>\r\n            <div className=\"p-4 space-y-4\">\r\n              {field.fields.map((f, i) => {\r\n                const nestedPath =\r\n                  \"name\" in f ? `${rowPath}.${f.name}` : rowPath;\r\n                return (\r\n                  <FieldRenderer\r\n                    key={i}\r\n                    field={f}\r\n                    path={nestedPath}\r\n                    form={form}\r\n                    registry={registry}\r\n                  />\r\n                );\r\n              })}\r\n            </div>\r\n          </CollapsibleContent>\r\n        </div>\r\n      </Collapsible>\r\n    );\r\n  },\r\n  (prevProps, nextProps) => {\r\n    return (\r\n      prevProps.id === nextProps.id &&\r\n      prevProps.index === nextProps.index &&\r\n      prevProps.isOpen === nextProps.isOpen &&\r\n      prevProps.canRemove === nextProps.canRemove &&\r\n      prevProps.canDuplicate === nextProps.canDuplicate &&\r\n      prevProps.isSortable === nextProps.isSortable &&\r\n      prevProps.isDisabled === nextProps.isDisabled &&\r\n      prevProps.isReadOnly === nextProps.isReadOnly &&\r\n      prevProps.path === nextProps.path &&\r\n      prevProps.isNew === nextProps.isNew &&\r\n      prevProps.isExiting === nextProps.isExiting\r\n    );\r\n  }\r\n);\r\n\r\nArrayRow.displayName = \"ArrayRow\";\r\n\r\n// =============================================================================\r\n// MAIN COMPONENT\r\n// =============================================================================\r\n\r\nexport const ArrayField = React.forwardRef<\r\n  HTMLDivElement,\r\n  ArrayFieldComponentProps\r\n>(\r\n  (\r\n    {\r\n      field,\r\n      path,\r\n      form,\r\n      registry,\r\n      isDisabled,\r\n      isReadOnly,\r\n      label,\r\n      error,\r\n    }: ArrayFieldComponentProps,\r\n    ref\r\n  ) => {\r\n    const dndContextId = React.useId();\r\n\r\n    // UI options with type-safe defaults\r\n    const ui = field.ui;\r\n    const isSortable = ui?.isSortable !== false;\r\n    const addLabel = ui?.addLabel ?? \"Add Item\";\r\n    const showErrorBadge = ui?.showErrorBadge !== false;\r\n    const emptyMessage = ui?.emptyMessage ?? \"No items added yet\";\r\n\r\n    // Initialize collapsed states from UI options\r\n    const [isArrayCollapsed, setIsArrayCollapsed] = React.useState(\r\n      ui?.collapsed ?? false\r\n    );\r\n    const [collapsedRowsMap, setCollapsedRowsMap] = React.useState<\r\n      Record<string, boolean>\r\n    >({});\r\n    const [showDeleteAllDialog, setShowDeleteAllDialog] = React.useState(false);\r\n\r\n    // Track newly added rows and exiting rows for animation\r\n    const [newRowIds, setNewRowIds] = React.useState<Set<string>>(new Set());\r\n    const [exitingRowIds, setExitingRowIds] = React.useState<Set<string>>(\r\n      new Set()\r\n    );\r\n\r\n    // Screen reader announcement\r\n    const [announcement, setAnnouncement] = React.useState<string>(\"\");\r\n\r\n    // Use form.array.fields() for stable items with IDs\r\n    const rows = form.array.fields<ArrayRowItem>(path);\r\n\r\n    // Initialize row collapsed state when rows change (for ui.rowsCollapsed)\r\n    React.useEffect(() => {\r\n      if (ui?.rowsCollapsed && rows.length > 0) {\r\n        const newMap: Record<string, boolean> = {};\r\n        for (const row of rows) {\r\n          // Only collapse new rows, preserve existing state\r\n          if (collapsedRowsMap[row.id] === undefined) {\r\n            newMap[row.id] = true;\r\n          }\r\n        }\r\n        if (Object.keys(newMap).length > 0) {\r\n          setCollapsedRowsMap((prev) => ({ ...prev, ...newMap }));\r\n        }\r\n      }\r\n    }, [rows, ui?.rowsCollapsed, collapsedRowsMap]);\r\n\r\n    // Track previous rows to detect additions for animation\r\n    const prevRowsRef = React.useRef(rows);\r\n\r\n    // Use useLayoutEffect to detect additions synchronously to avoid flicker\r\n    React.useLayoutEffect(() => {\r\n      const prevRows = prevRowsRef.current;\r\n\r\n      // Detect additions (length increased)\r\n      if (rows.length > prevRows.length) {\r\n        // Find IDs that are in current but not in prev\r\n        const prevIds = new Set(prevRows.map((r) => r.id));\r\n        const newItems = rows.filter((r) => !prevIds.has(r.id));\r\n\r\n        if (newItems.length > 0) {\r\n          const idsToAdd = newItems.map((r) => r.id);\r\n          setNewRowIds((prev) => {\r\n            const next = new Set(prev);\r\n            idsToAdd.forEach((id) => next.add(id));\r\n            return next;\r\n          });\r\n        }\r\n      }\r\n\r\n      // Update ref for next render\r\n      prevRowsRef.current = rows;\r\n    }, [rows]);\r\n\r\n    // Clear \"new\" status after animation completes\r\n    React.useEffect(() => {\r\n      if (newRowIds.size > 0) {\r\n        const timer = setTimeout(() => {\r\n          setNewRowIds(new Set());\r\n        }, 700); // Match animation duration\r\n        return () => clearTimeout(timer);\r\n      }\r\n    }, [newRowIds]);\r\n\r\n    // Calculate total errors across all rows for header badge\r\n    const totalErrorCount = useArrayErrors(\r\n      form,\r\n      field.fields,\r\n      path,\r\n      rows.length\r\n    );\r\n    const combinedErrorCount = totalErrorCount + (error ? 1 : 0);\r\n\r\n    const sensors = useSensors(\r\n      useSensor(PointerSensor, {\r\n        activationConstraint: {\r\n          distance: 10,\r\n        },\r\n      }),\r\n      useSensor(KeyboardSensor, {\r\n        coordinateGetter: sortableKeyboardCoordinates,\r\n      })\r\n    );\r\n\r\n    const handleDragEnd = (event: DragEndEvent) => {\r\n      const { active, over } = event;\r\n      if (over && active.id !== over.id) {\r\n        const oldIndex = rows.findIndex((r) => r.id === active.id);\r\n        const newIndex = rows.findIndex((r) => r.id === over.id);\r\n        if (oldIndex !== -1 && newIndex !== -1) {\r\n          form.array.move(path, oldIndex, newIndex);\r\n        }\r\n      }\r\n    };\r\n\r\n    const handleAdd = (e?: React.MouseEvent) => {\r\n      e?.stopPropagation();\r\n      if (!isDisabled && !isReadOnly) {\r\n        form.array.append(path, {});\r\n        setAnnouncement(`Item ${rows.length + 1} added`);\r\n      }\r\n    };\r\n\r\n    const handleRemove = (index: number) => {\r\n      const rowToRemove = rows[index];\r\n      if (!rowToRemove) return;\r\n\r\n      const removedLabel = getArrayRowLabel(\r\n        rowToRemove,\r\n        field.fields,\r\n        field.ui,\r\n        `Item ${index + 1}`\r\n      );\r\n\r\n      // 1. Mark as exiting to trigger animation\r\n      setExitingRowIds((prev) => new Set([...prev, rowToRemove.id]));\r\n\r\n      // 2. Wait for animation to complete before actual removal\r\n      setTimeout(() => {\r\n        // Find fresh index of this ID in case list changed\r\n        const currentRows = form.array.fields<ArrayRowItem>(path);\r\n        const currentIndex = currentRows.findIndex(\r\n          (r) => r.id === rowToRemove.id\r\n        );\r\n\r\n        if (currentIndex !== -1) {\r\n          form.array.remove(path, currentIndex);\r\n          setAnnouncement(`${removedLabel} removed`);\r\n        }\r\n\r\n        // Cleanup exiting state\r\n        setExitingRowIds((prev) => {\r\n          const next = new Set(prev);\r\n          next.delete(rowToRemove.id);\r\n          return next;\r\n        });\r\n      }, 300); // Match CSS animation duration\r\n    };\r\n\r\n    const handleDuplicate = (index: number) => {\r\n      if (field.maxRows && rows.length >= field.maxRows) {\r\n        return;\r\n      }\r\n\r\n      const currentValue = rows[index];\r\n      if (currentValue) {\r\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n        const { id, ...rest } = currentValue;\r\n        form.array.insert(path, index + 1, rest);\r\n        setAnnouncement(`Item ${index + 1} duplicated`);\r\n      }\r\n    };\r\n\r\n    const handleRemoveAllClick = (e: React.MouseEvent) => {\r\n      e.stopPropagation();\r\n      // Check if confirmation is required (default: true for safety)\r\n      if (ui?.confirmDelete !== false) {\r\n        setShowDeleteAllDialog(true);\r\n      } else {\r\n        form.array.replace(path, []);\r\n      }\r\n    };\r\n\r\n    const handleConfirmRemoveAll = () => {\r\n      form.array.replace(path, []);\r\n      setShowDeleteAllDialog(false);\r\n    };\r\n\r\n    const handleToggleRow = (index: number) => {\r\n      const rowId = rows[index]?.id;\r\n      if (rowId) {\r\n        setCollapsedRowsMap((prev) => ({\r\n          ...prev,\r\n          [rowId]: !prev[rowId],\r\n        }));\r\n      }\r\n    };\r\n\r\n    const handleToggleAllRows = (e: React.MouseEvent) => {\r\n      e.stopPropagation();\r\n      // If any row is open, we want to collapse all.\r\n      // Only if ALL are collapsed, we expand all.\r\n      const anyOpen = rows.some((row) => !collapsedRowsMap[row.id]);\r\n\r\n      const newMap: Record<string, boolean> = {};\r\n      for (const row of rows) {\r\n        newMap[row.id] = anyOpen;\r\n      }\r\n      setCollapsedRowsMap(newMap);\r\n    };\r\n\r\n    const allRowsCollapsed =\r\n      rows.length > 0 && rows.every((row) => collapsedRowsMap[row.id]);\r\n    const canAddMore = !field.maxRows || rows.length < field.maxRows;\r\n    const canRemoveAny = !field.minRows || rows.length > field.minRows;\r\n\r\n    const bodyContent = (\r\n      <CardContent className=\"pt-4 px-4 pb-4\">\r\n        {rows.length > 0 ? (\r\n          <DndContext\r\n            id={dndContextId}\r\n            sensors={sensors}\r\n            collisionDetection={closestCenter}\r\n            onDragEnd={handleDragEnd}\r\n          >\r\n            <SortableContext\r\n              items={rows.map((r) => r.id)}\r\n              strategy={verticalListSortingStrategy}\r\n            >\r\n              <div\r\n                className=\"space-y-3\"\r\n                role=\"list\"\r\n                aria-label={`${label} items`}\r\n              >\r\n                {rows.map((row, index) => (\r\n                  <ArrayRow\r\n                    key={row.id}\r\n                    id={row.id}\r\n                    index={index}\r\n                    field={field}\r\n                    path={path}\r\n                    form={form}\r\n                    registry={registry}\r\n                    onRemove={handleRemove}\r\n                    onDuplicate={handleDuplicate}\r\n                    isOpen={!collapsedRowsMap[row.id]}\r\n                    onToggle={handleToggleRow}\r\n                    canRemove={!field.minRows || rows.length > field.minRows}\r\n                    canDuplicate={canAddMore}\r\n                    isSortable={isSortable}\r\n                    isDisabled={isDisabled}\r\n                    isReadOnly={isReadOnly}\r\n                    isNew={newRowIds.has(row.id)}\r\n                    isExiting={exitingRowIds.has(row.id)}\r\n                  />\r\n                ))}\r\n              </div>\r\n            </SortableContext>\r\n          </DndContext>\r\n        ) : (\r\n          <div className=\"flex flex-col items-center justify-center py-12 px-4 border-2 border-dashed rounded-lg text-center\">\r\n            <IconPlaceholder\r\n              lucide=\"ListPlus\"\r\n              hugeicons=\"InsertRowDownIcon\"\r\n              tabler=\"IconRowInsertBottom\"\r\n              phosphor=\"ListPlus\"\r\n              remixicon=\"RiPlayListAddLine\"\r\n              className=\"size-10 text-muted-foreground/50 mb-3\"\r\n            />\r\n            <p className=\"text-sm font-medium text-muted-foreground mb-1\">\r\n              {emptyMessage}\r\n            </p>\r\n            <p className=\"text-xs text-muted-foreground/75 mb-4\">\r\n              Click the button below to add your first item\r\n            </p>\r\n            {!isReadOnly && (\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={handleAdd}\r\n                disabled={!canAddMore || isDisabled}\r\n              >\r\n                <IconPlaceholder\r\n                  lucide=\"Plus\"\r\n                  hugeicons=\"Add01Icon\"\r\n                  tabler=\"IconPlus\"\r\n                  phosphor=\"Plus\"\r\n                  remixicon=\"RiAddLine\"\r\n                  className=\"size-4 mr-1.5\"\r\n                />\r\n                {addLabel}\r\n              </Button>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Footer Add Button - Rendered when items exist to allow adding at the bottom */}\r\n        {rows.length > 0 && !isReadOnly && (\r\n          <Button\r\n            type=\"button\"\r\n            variant=\"outline\"\r\n            className=\"w-full mt-4 border-dashed border-muted-foreground/25 hover:border-primary/50 hover:bg-muted/50 text-muted-foreground hover:text-foreground transition-all\"\r\n            onClick={handleAdd}\r\n            disabled={!canAddMore || isDisabled}\r\n          >\r\n            <IconPlaceholder\r\n              lucide=\"Plus\"\r\n              hugeicons=\"Add01Icon\"\r\n              tabler=\"IconPlus\"\r\n              phosphor=\"Plus\"\r\n              remixicon=\"RiAddLine\"\r\n              className=\"size-4 mr-2\"\r\n            />\r\n            {addLabel}\r\n          </Button>\r\n        )}\r\n\r\n        {typeof field.minRows === \"number\" &&\r\n          field.minRows > 0 &&\r\n          rows.length < field.minRows && (\r\n            <div className=\"mt-3 text-xs text-destructive flex items-center gap-1.5 px-1 font-medium\">\r\n              <IconPlaceholder\r\n                lucide=\"AlertCircle\"\r\n                hugeicons=\"SecurityBlockIcon\"\r\n                tabler=\"IconAlertCircle\"\r\n                phosphor=\"Warning\"\r\n                remixicon=\"RiAlertLine\"\r\n                className=\"size-3.5\"\r\n              />\r\n              Minimum {field.minRows} {field.minRows === 1 ? \"item\" : \"items\"}{\" \"}\r\n              required\r\n            </div>\r\n          )}\r\n\r\n        {typeof field.maxRows === \"number\" &&\r\n          rows.length > field.maxRows &&\r\n          !error && (\r\n            <div className=\"mt-3 text-xs text-destructive flex items-center gap-1.5 px-1 font-medium\">\r\n              <IconPlaceholder\r\n                lucide=\"AlertCircle\"\r\n                hugeicons=\"SecurityBlockIcon\"\r\n                tabler=\"IconAlertCircle\"\r\n                phosphor=\"Warning\"\r\n                remixicon=\"RiAlertLine\"\r\n                className=\"size-3.5\"\r\n              />\r\n              Maximum {field.maxRows} {field.maxRows === 1 ? \"item\" : \"items\"}{\" \"}\r\n              allowed\r\n            </div>\r\n          )}\r\n      </CardContent>\r\n    );\r\n\r\n    return (\r\n      <>\r\n        {/* Screen reader announcements */}\r\n        <div\r\n          role=\"status\"\r\n          aria-live=\"polite\"\r\n          aria-atomic=\"true\"\r\n          className=\"sr-only\"\r\n        >\r\n          {announcement}\r\n        </div>\r\n\r\n        {/* Delete All Confirmation Dialog */}\r\n        <AlertDialog\r\n          open={showDeleteAllDialog}\r\n          onOpenChange={setShowDeleteAllDialog}\r\n        >\r\n          <AlertDialogContent>\r\n            <AlertDialogHeader>\r\n              <AlertDialogMedia className=\"bg-destructive/10 text-destructive\">\r\n                <IconPlaceholder\r\n                  lucide=\"Trash2\"\r\n                  hugeicons=\"Delete02Icon\"\r\n                  tabler=\"IconTrash\"\r\n                  phosphor=\"Trash\"\r\n                  remixicon=\"RiDeleteBinLine\"\r\n                  className=\"size-5\"\r\n                />\r\n              </AlertDialogMedia>\r\n              <AlertDialogTitle>Delete all items?</AlertDialogTitle>\r\n              <AlertDialogDescription>\r\n                This will permanently remove all {rows.length}{\" \"}\r\n                {rows.length === 1 ? \"item\" : \"items\"} from this list. This\r\n                action cannot be undone.\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter>\r\n              <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n              <AlertDialogAction\r\n                variant=\"destructive\"\r\n                onClick={handleConfirmRemoveAll}\r\n              >\r\n                Delete All\r\n              </AlertDialogAction>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n\r\n        <Collapsible\r\n          open={!isArrayCollapsed}\r\n          onOpenChange={(open) => setIsArrayCollapsed(!open)}\r\n        >\r\n          <Card\r\n            ref={ref}\r\n            className={cn(\r\n              \"py-0 gap-0\",\r\n              field.style?.className,\r\n              isDisabled && \"opacity-60\"\r\n            )}\r\n            style={\r\n              field.style?.width ? { width: field.style.width } : undefined\r\n            }\r\n          >\r\n            <CardHeader\r\n              className={cn(\r\n                \"flex flex-row items-center justify-between bg-muted/50 transition-colors py-3 px-4\",\r\n                !isArrayCollapsed && \"border-b\"\r\n              )}\r\n            >\r\n              <CollapsibleTrigger className=\"flex items-start gap-2 cursor-pointer hover:opacity-80 transition-opacity flex-1 min-w-0 py-1\">\r\n                <IconPlaceholder\r\n                  lucide=\"ChevronDown\"\r\n                  hugeicons=\"ArrowDown01Icon\"\r\n                  tabler=\"IconChevronDown\"\r\n                  phosphor=\"CaretDown\"\r\n                  remixicon=\"RiArrowDownSLine\"\r\n                  className={cn(\r\n                    \"size-4 text-muted-foreground transition-transform duration-200 shrink-0 mt-0.5\",\r\n                    isArrayCollapsed && \"-rotate-90\"\r\n                  )}\r\n                />\r\n                <div className=\"flex flex-col items-start gap-0.5 min-w-0 w-full\">\r\n                  <div className=\"flex flex-wrap items-center gap-x-2 gap-y-1 w-full pr-2\">\r\n                    <span className=\"font-semibold text-sm truncate\">\r\n                      {label}\r\n                    </span>\r\n                    {field.required && (\r\n                      <span className=\"text-destructive\">*</span>\r\n                    )}\r\n                    {rows.length > 0 && (\r\n                      <Badge\r\n                        variant=\"secondary\"\r\n                        className=\"h-5 px-1.5 text-xs whitespace-nowrap shrink-0\"\r\n                      >\r\n                        {rows.length} {rows.length === 1 ? \"item\" : \"items\"}\r\n                      </Badge>\r\n                    )}\r\n                    {showErrorBadge && combinedErrorCount > 0 && (\r\n                      <Badge\r\n                        variant=\"destructive\"\r\n                        className=\"h-5 px-1.5 text-xs whitespace-nowrap shrink-0\"\r\n                      >\r\n                        {combinedErrorCount}{\" \"}\r\n                        {combinedErrorCount === 1 ? \"error\" : \"errors\"}\r\n                      </Badge>\r\n                    )}\r\n                  </div>\r\n                  {field.description && (\r\n                    <p className=\"text-xs text-muted-foreground text-left wrap-break-word leading-tight w-full pr-2\">\r\n                      {field.description}\r\n                    </p>\r\n                  )}\r\n                  {error && (\r\n                    <p\r\n                      role=\"alert\"\r\n                      className=\"text-xs text-destructive text-left wrap-break-word leading-tight w-full pr-2\"\r\n                    >\r\n                      {error}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              </CollapsibleTrigger>\r\n              {!isReadOnly && (\r\n                <div className=\"flex items-center gap-1\">\r\n                  {rows.length > 0 && (\r\n                    <>\r\n                      <Button\r\n                        type=\"button\"\r\n                        variant=\"ghost\"\r\n                        size=\"icon\"\r\n                        className=\"h-7 w-7 text-muted-foreground hover:text-foreground active:scale-95 transition-all\"\r\n                        onClick={handleToggleAllRows}\r\n                        disabled={isDisabled}\r\n                        title={\r\n                          allRowsCollapsed\r\n                            ? \"Expand all items\"\r\n                            : \"Collapse all items\"\r\n                        }\r\n                        aria-label={\r\n                          allRowsCollapsed\r\n                            ? \"Expand all items\"\r\n                            : \"Collapse all items\"\r\n                        }\r\n                      >\r\n                        {allRowsCollapsed ? (\r\n                          <IconPlaceholder\r\n                            lucide=\"ChevronsUpDown\"\r\n                            hugeicons=\"ArrowExpand02Icon\"\r\n                            tabler=\"IconArrowsMaximize\"\r\n                            phosphor=\"ArrowsOutSimple\"\r\n                            remixicon=\"RiExpandUpDownLine\"\r\n                            className=\"size-4\"\r\n                          />\r\n                        ) : (\r\n                          <IconPlaceholder\r\n                            lucide=\"ChevronsDownUp\"\r\n                            hugeicons=\"ArrowShrink02Icon\"\r\n                            tabler=\"IconArrowsMinimize\"\r\n                            phosphor=\"ArrowsInSimple\"\r\n                            remixicon=\"RiContractUpDownLine\"\r\n                            className=\"size-4\"\r\n                          />\r\n                        )}\r\n                      </Button>\r\n                      <Button\r\n                        type=\"button\"\r\n                        variant=\"ghost\"\r\n                        size=\"icon\"\r\n                        className={cn(\r\n                          \"h-7 w-7 text-destructive hover:bg-destructive/10 active:scale-95 transition-all\",\r\n                          (!canRemoveAny || isDisabled) &&\r\n                            \"opacity-50 cursor-not-allowed\"\r\n                        )}\r\n                        onClick={handleRemoveAllClick}\r\n                        disabled={isDisabled || !canRemoveAny}\r\n                        title={\r\n                          canRemoveAny\r\n                            ? \"Delete all items\"\r\n                            : `Minimum ${field.minRows} items required`\r\n                        }\r\n                        aria-label={\r\n                          canRemoveAny\r\n                            ? \"Delete all items\"\r\n                            : `Minimum ${field.minRows} items required`\r\n                        }\r\n                      >\r\n                        <IconPlaceholder\r\n                          lucide=\"Trash2\"\r\n                          hugeicons=\"DeletePutBackIcon\"\r\n                          tabler=\"IconTrash\"\r\n                          phosphor=\"TrashSimple\"\r\n                          remixicon=\"RiDeleteBinLine\"\r\n                          className=\"size-4\"\r\n                        />\r\n                      </Button>\r\n                    </>\r\n                  )}\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"ghost\"\r\n                    size=\"icon\"\r\n                    className=\"h-7 w-7 active:scale-95 transition-all\"\r\n                    disabled={!canAddMore || isDisabled}\r\n                    onClick={handleAdd}\r\n                    title={\r\n                      canAddMore\r\n                        ? \"Add item\"\r\n                        : `Maximum ${field.maxRows} items reached`\r\n                    }\r\n                    aria-label={\r\n                      canAddMore\r\n                        ? \"Add item\"\r\n                        : `Maximum ${field.maxRows} items reached`\r\n                    }\r\n                  >\r\n                    <IconPlaceholder\r\n                      lucide=\"Plus\"\r\n                      hugeicons=\"Add01Icon\"\r\n                      tabler=\"IconPlus\"\r\n                      phosphor=\"Plus\"\r\n                      remixicon=\"RiAddLine\"\r\n                      className=\"size-4\"\r\n                    />\r\n                  </Button>\r\n                </div>\r\n              )}\r\n            </CardHeader>\r\n            <CollapsibleContent>{bodyContent}</CollapsibleContent>\r\n          </Card>\r\n        </Collapsible>\r\n      </>\r\n    );\r\n  }\r\n);\r\n\r\nArrayField.displayName = \"ArrayField\";\r\n\r\n// =============================================================================\r\n// SKELETON\r\n// =============================================================================\r\n\r\nexport const ArrayFieldSkeleton = React.forwardRef<\r\n  HTMLDivElement,\r\n  { field: ArrayFieldType }\r\n>(({ field }: { field: ArrayFieldType }, ref) => {\r\n  const label = field.label !== false ? field.label || field.name : null;\r\n\r\n  return (\r\n    <Card ref={ref} className={cn(\"py-0\", field.style?.className)}>\r\n      <CardHeader className=\"flex flex-row justify-between items-center py-3 px-4 bg-muted/50 border-b\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Skeleton className=\"h-4 w-4\" />\r\n          {label && <Skeleton className=\"h-4 w-24\" />}\r\n          <Skeleton className=\"h-5 w-12 rounded-full\" />\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <Skeleton className=\"h-7 w-7 rounded\" />\r\n          <Skeleton className=\"h-7 w-7 rounded\" />\r\n          <Skeleton className=\"h-7 w-7 rounded\" />\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent className=\"p-4 space-y-3\">\r\n        {[1, 2].map((i) => (\r\n          <div\r\n            key={i}\r\n            className=\"border rounded-lg overflow-hidden animate-pulse\"\r\n          >\r\n            <div className=\"flex items-center gap-3 px-4 py-2 bg-muted/50\">\r\n              <Skeleton className=\"h-4 w-4\" />\r\n              <Skeleton className=\"h-4 w-4\" />\r\n              <Skeleton className=\"h-4 w-32 flex-1\" />\r\n              <Skeleton className=\"h-7 w-7 rounded\" />\r\n              <Skeleton className=\"h-7 w-7 rounded\" />\r\n            </div>\r\n            <div className=\"p-4 space-y-3\">\r\n              <div className=\"space-y-2\">\r\n                <Skeleton className=\"h-4 w-20\" />\r\n                <Skeleton className=\"h-9 w-full rounded-md\" />\r\n              </div>\r\n              <div className=\"space-y-2\">\r\n                <Skeleton className=\"h-4 w-24\" />\r\n                <Skeleton className=\"h-9 w-full rounded-md\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n});\r\n\r\nArrayFieldSkeleton.displayName = \"ArrayFieldSkeleton\";\r\n",
      "type": "registry:component",
      "target": "components/buzzform/fields/array.tsx"
    }
  ],
  "type": "registry:ui"
}