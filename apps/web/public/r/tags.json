{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "tags",
  "title": "TagsField",
  "description": "A chip-based multi-value tag input field for BuzzForm. Supports customizable delimiters (enter, comma, space, tab), variants (chips, pills, inline), min/max tags, duplicate handling, and copy-to-clipboard.",
  "dependencies": [
    "@buildnbuzz/buzzform"
  ],
  "registryDependencies": [
    "@buzzform/init",
    "badge",
    "field",
    "@buzzform/copy"
  ],
  "files": [
    {
      "path": "registry/base/fields/tags.tsx",
      "content": "\"use client\";\r\n\r\nimport React, {\r\n  useState,\r\n  useRef,\r\n  useCallback,\r\n  useMemo,\r\n  KeyboardEvent,\r\n} from \"react\";\r\nimport type {\r\n  TagsField as TagsFieldType,\r\n  FormAdapter,\r\n} from \"@buildnbuzz/buzzform\";\r\nimport { getFieldWidthStyle } from \"@buildnbuzz/buzzform\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { CopyButton } from \"@/components/buzzform/copy\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport {\r\n  Field,\r\n  FieldContent,\r\n  FieldDescription,\r\n  FieldError,\r\n  FieldLabel,\r\n} from \"@/components/ui/field\";\r\n\r\nexport interface TagsFieldProps {\r\n  field: TagsFieldType;\r\n  path: string;\r\n  form: FormAdapter;\r\n  autoFocus?: boolean;\r\n  // Computed props\r\n  fieldId: string;\r\n  label: React.ReactNode | null;\r\n  isDisabled: boolean;\r\n  isReadOnly: boolean;\r\n  error?: string;\r\n}\r\n\r\n// X icon for removing tags\r\nfunction XIcon({ className }: { className?: string }) {\r\n  return (\r\n    <svg\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      strokeWidth=\"2\"\r\n      strokeLinecap=\"round\"\r\n      strokeLinejoin=\"round\"\r\n      className={className}\r\n    >\r\n      <path d=\"M18 6 6 18\" />\r\n      <path d=\"m6 6 12 12\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport function TagsField({\r\n  field,\r\n  path,\r\n  form,\r\n  autoFocus,\r\n  fieldId,\r\n  label,\r\n  isDisabled,\r\n  isReadOnly,\r\n  error,\r\n}: TagsFieldProps) {\r\n  const [inputValue, setInputValue] = useState(\"\");\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Watch field value directly\r\n  const rawValue = form.watch<string[]>(path);\r\n  const emptyTags = useMemo(() => [], []);\r\n  const tags = Array.isArray(rawValue) ? rawValue : emptyTags;\r\n  const hasError = !!error;\r\n\r\n  // Get delimiters from field config - memoized\r\n  const delimiters = useMemo(\r\n    () => field.ui?.delimiters ?? [\"enter\"],\r\n    [field.ui?.delimiters]\r\n  );\r\n  const variant = field.ui?.variant ?? \"chips\";\r\n  const allowDuplicates = field.allowDuplicates ?? false;\r\n  const maxTags = field.maxTags;\r\n  const maxTagLength = field.maxTagLength;\r\n\r\n  const canAddMore = maxTags === undefined || tags.length < maxTags;\r\n\r\n  const updateTags = useCallback(\r\n    (newTags: string[]) => {\r\n      form.setValue(path, newTags, { shouldDirty: true });\r\n    },\r\n    [form, path]\r\n  );\r\n\r\n  const addTag = useCallback(\r\n    (tagValue: string) => {\r\n      const trimmed = tagValue.trim();\r\n      if (!trimmed) return false;\r\n\r\n      // Check max tag length\r\n      if (maxTagLength && trimmed.length > maxTagLength) return false;\r\n\r\n      // Check for duplicates\r\n      if (!allowDuplicates && tags.includes(trimmed)) return false;\r\n\r\n      // Check max tags limit\r\n      if (maxTags !== undefined && tags.length >= maxTags) return false;\r\n\r\n      updateTags([...tags, trimmed]);\r\n      return true;\r\n    },\r\n    [tags, updateTags, allowDuplicates, maxTags, maxTagLength]\r\n  );\r\n\r\n  const removeTag = useCallback(\r\n    (index: number) => {\r\n      if (isDisabled || isReadOnly) return;\r\n      const newTags = tags.filter((_, i) => i !== index);\r\n      updateTags(newTags);\r\n    },\r\n    [tags, updateTags, isDisabled, isReadOnly]\r\n  );\r\n\r\n  const handleKeyDown = useCallback(\r\n    (e: KeyboardEvent<HTMLInputElement>) => {\r\n      const currentValue = inputValue.trim();\r\n\r\n      // Handle backspace to remove last tag\r\n      if (e.key === \"Backspace\" && !inputValue && tags.length > 0) {\r\n        removeTag(tags.length - 1);\r\n        return;\r\n      }\r\n\r\n      // Check delimiter keys\r\n      const shouldAdd =\r\n        (delimiters.includes(\"enter\") && e.key === \"Enter\") ||\r\n        (delimiters.includes(\"comma\") && e.key === \",\") ||\r\n        (delimiters.includes(\"space\") && e.key === \" \") ||\r\n        (delimiters.includes(\"tab\") && e.key === \"Tab\");\r\n\r\n      if (shouldAdd && currentValue) {\r\n        e.preventDefault();\r\n        if (addTag(currentValue)) {\r\n          setInputValue(\"\");\r\n        }\r\n      }\r\n    },\r\n    [inputValue, tags, delimiters, addTag, removeTag]\r\n  );\r\n\r\n  const handleInputChange = useCallback(\r\n    (e: React.ChangeEvent<HTMLInputElement>) => {\r\n      const newValue = e.target.value;\r\n\r\n      // Handle comma/space delimiter if they're active\r\n      if (\r\n        delimiters.includes(\"comma\") &&\r\n        newValue.includes(\",\") &&\r\n        !newValue.endsWith(\",\")\r\n      ) {\r\n        const parts = newValue.split(\",\");\r\n        const lastPart = parts.pop() ?? \"\";\r\n        parts.forEach((part) => addTag(part));\r\n        setInputValue(lastPart);\r\n        return;\r\n      }\r\n\r\n      setInputValue(newValue);\r\n    },\r\n    [delimiters, addTag]\r\n  );\r\n\r\n  const handleBlur = useCallback(() => {\r\n    // Optionally add pending tag on blur\r\n    const trimmed = inputValue.trim();\r\n    if (trimmed) {\r\n      if (addTag(trimmed)) {\r\n        setInputValue(\"\");\r\n      }\r\n    }\r\n    form.onBlur?.(path);\r\n  }, [inputValue, addTag, form, path]);\r\n\r\n  const handleContainerClick = useCallback(() => {\r\n    if (!isDisabled && !isReadOnly) {\r\n      inputRef.current?.focus();\r\n    }\r\n  }, [isDisabled, isReadOnly]);\r\n\r\n  // Get variant-specific styles\r\n  const getTagStyles = () => {\r\n    switch (variant) {\r\n      case \"pills\":\r\n        return \"rounded-full px-3 py-0.5\";\r\n      case \"inline\":\r\n        return \"rounded-none border-0 border-b-2 px-1 py-0 bg-transparent\";\r\n      case \"chips\":\r\n      default:\r\n        return \"rounded-md px-2 py-0.5\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Field\r\n      className={field.style?.className}\r\n      data-invalid={hasError}\r\n      data-disabled={isDisabled}\r\n      style={getFieldWidthStyle(field.style)}\r\n    >\r\n      {label && (\r\n        <FieldLabel htmlFor={fieldId} className=\"gap-1 items-baseline\">\r\n          {label}\r\n          {field.required && <span className=\"text-destructive\">*</span>}\r\n        </FieldLabel>\r\n      )}\r\n\r\n      <FieldContent>\r\n        <div className=\"relative\">\r\n          <div\r\n            ref={containerRef}\r\n            onClick={handleContainerClick}\r\n            className={cn(\r\n              \"flex flex-wrap items-center gap-1.5 min-h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background\",\r\n              \"focus-within:outline-none focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2\",\r\n              hasError && \"border-destructive focus-within:ring-destructive\",\r\n              isDisabled && \"cursor-not-allowed opacity-50\",\r\n              isReadOnly && \"cursor-default bg-muted\",\r\n              field.ui?.copyable && \"pr-10\"\r\n            )}\r\n          >\r\n            {tags.map((tag, index) => (\r\n              <Badge\r\n                key={`${tag}-${index}`}\r\n                variant=\"secondary\"\r\n                className={cn(\r\n                  \"gap-1 h-6 text-xs font-normal shrink-0\",\r\n                  getTagStyles(),\r\n                  !isDisabled && !isReadOnly && \"pr-1\"\r\n                )}\r\n              >\r\n                <span className=\"truncate max-w-37.5\">{tag}</span>\r\n                {!isDisabled && !isReadOnly && (\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      removeTag(index);\r\n                    }}\r\n                    className=\"ml-0.5 rounded-full p-0.5 hover:bg-muted-foreground/20 focus:outline-none focus:ring-1 focus:ring-ring\"\r\n                    aria-label={`Remove ${tag}`}\r\n                  >\r\n                    <XIcon className=\"size-3\" />\r\n                  </button>\r\n                )}\r\n              </Badge>\r\n            ))}\r\n\r\n            {!isReadOnly && canAddMore && (\r\n              <input\r\n                ref={inputRef}\r\n                id={fieldId}\r\n                type=\"text\"\r\n                value={inputValue}\r\n                onChange={handleInputChange}\r\n                onKeyDown={handleKeyDown}\r\n                onBlur={handleBlur}\r\n                placeholder={\r\n                  tags.length === 0 ? (field.placeholder ?? \"Add tags...\") : \"\"\r\n                }\r\n                disabled={isDisabled}\r\n                autoFocus={autoFocus}\r\n                autoComplete={field.autoComplete ?? \"off\"}\r\n                aria-invalid={hasError}\r\n                aria-describedby={\r\n                  field.description ? `${fieldId}-description` : undefined\r\n                }\r\n                className={cn(\r\n                  \"flex-1 min-w-20 bg-transparent outline-none text-sm placeholder:text-muted-foreground\",\r\n                  \"disabled:cursor-not-allowed\"\r\n                )}\r\n              />\r\n            )}\r\n\r\n            {isReadOnly && tags.length === 0 && (\r\n              <span className=\"text-muted-foreground text-sm\">No tags</span>\r\n            )}\r\n          </div>\r\n\r\n          {field.ui?.copyable && tags.length > 0 && (\r\n            <CopyButton\r\n              value={tags.join(\", \")}\r\n              disabled={isDisabled}\r\n              className=\"absolute right-0 top-0 h-full px-3 text-muted-foreground hover:text-foreground\"\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        {/* Tag count indicator */}\r\n        {maxTags !== undefined && (\r\n          <div className=\"mt-1 text-xs text-muted-foreground\">\r\n            {tags.length} / {maxTags} tags\r\n          </div>\r\n        )}\r\n      </FieldContent>\r\n\r\n      {field.description && (\r\n        <FieldDescription id={`${fieldId}-description`}>\r\n          {field.description}\r\n        </FieldDescription>\r\n      )}\r\n\r\n      {error && <FieldError>{error}</FieldError>}\r\n    </Field>\r\n  );\r\n}\r\n\r\nexport function TagsFieldSkeleton({ field }: { field: TagsFieldType }) {\r\n  const label = field.label !== false ? (field.label ?? field.name) : null;\r\n\r\n  return (\r\n    <Field\r\n      className={field.style?.className}\r\n      style={\r\n        field.style?.width\r\n          ? {\r\n              width:\r\n                typeof field.style.width === \"number\"\r\n                  ? `${field.style.width}px`\r\n                  : field.style.width,\r\n            }\r\n          : undefined\r\n      }\r\n    >\r\n      {label && <div className=\"h-4 w-24 animate-pulse rounded bg-muted\" />}\r\n      <FieldContent>\r\n        <div className=\"h-10 w-full animate-pulse rounded-lg bg-muted\" />\r\n      </FieldContent>\r\n      {field.description && (\r\n        <div className=\"h-3 w-48 animate-pulse rounded bg-muted\" />\r\n      )}\r\n    </Field>\r\n  );\r\n}\r\n",
      "type": "registry:component",
      "target": "components/buzzform/fields/tags.tsx"
    }
  ],
  "type": "registry:ui"
}