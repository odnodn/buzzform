{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "date",
  "title": "DateField",
  "description": "A date and datetime field components for BuzzForm. Supports date and datetime selection, customizable formats (date-fns display), manual input parsing with inputFormat, and time picker options.",
  "dependencies": [
    "@buildnbuzz/buzzform",
    "date-fns"
  ],
  "registryDependencies": [
    "@buzzform/init",
    "popover",
    "calendar",
    "input",
    "input-group",
    "field"
  ],
  "files": [
    {
      "path": "registry/base/fields/date.tsx",
      "content": "\"use client\";\r\n\r\nimport React, { useState } from \"react\";\r\nimport type {\r\n  DateField as DateFieldType,\r\n  DatetimeField as DatetimeFieldType,\r\n  FormAdapter,\r\n} from \"@buildnbuzz/buzzform\";\r\nimport { parseToDate, getFieldWidthStyle } from \"@buildnbuzz/buzzform\";\r\nimport {\r\n  format,\r\n  parse,\r\n  setHours,\r\n  setMinutes,\r\n  setSeconds,\r\n  getHours,\r\n  getMinutes,\r\n  getSeconds,\r\n  startOfDay,\r\n  addDays,\r\n  startOfWeek,\r\n  addWeeks,\r\n  isValid,\r\n} from \"date-fns\";\r\nimport { IconPlaceholder } from \"@/components/icon-placeholder\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport {\r\n  InputGroup,\r\n  InputGroupAddon,\r\n  InputGroupButton,\r\n  InputGroupInput,\r\n} from \"@/components/ui/input-group\";\r\n\r\nimport {\r\n  Field,\r\n  FieldContent,\r\n  FieldDescription,\r\n  FieldError,\r\n  FieldGroup,\r\n  FieldLabel,\r\n} from \"@/components/ui/field\";\r\n\r\ntype Matcher =\r\n  | { before: Date }\r\n  | { after: Date }\r\n  | Date\r\n  | ((date: Date) => boolean);\r\n\r\nconst DEFAULT_PRESETS = [\r\n  { label: \"Today\", value: () => startOfDay(new Date()) },\r\n  { label: \"Tomorrow\", value: () => startOfDay(addDays(new Date(), 1)) },\r\n  {\r\n    label: \"Next Week\",\r\n    value: () => startOfWeek(addWeeks(new Date(), 1), { weekStartsOn: 1 }),\r\n  },\r\n];\r\n\r\nexport interface DateFieldProps {\r\n  field: DateFieldType | DatetimeFieldType;\r\n  path: string;\r\n  form: FormAdapter;\r\n  autoFocus?: boolean;\r\n  // Computed props\r\n  fieldId: string;\r\n  label: React.ReactNode | null;\r\n  isDisabled: boolean;\r\n  isReadOnly: boolean;\r\n  error?: string;\r\n}\r\n\r\nexport function DateField({\r\n  field,\r\n  path,\r\n  form,\r\n  autoFocus,\r\n  fieldId,\r\n  label,\r\n  isDisabled,\r\n  isReadOnly,\r\n  error,\r\n}: DateFieldProps) {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const value = form.watch(path);\r\n  const dateValue = parseToDate(value);\r\n  const hasError = !!error;\r\n\r\n  const timePickerConfig =\r\n    field.type === \"datetime\"\r\n      ? (field as DatetimeFieldType).ui?.timePicker\r\n      : undefined;\r\n  const hasTimePicker = field.type === \"datetime\";\r\n  const includeSeconds =\r\n    typeof timePickerConfig === \"object\"\r\n      ? timePickerConfig.includeSeconds === true\r\n      : false;\r\n  const use24hr =\r\n    typeof timePickerConfig === \"object\"\r\n      ? timePickerConfig.use24hr !== false\r\n      : true;\r\n\r\n  const dateInputFormat =\r\n    field.ui?.inputFormat || field.ui?.format || \"MM/dd/yyyy\";\r\n\r\n  const [inputText, setInputText] = useState(() =>\r\n    dateValue ? format(dateValue, dateInputFormat) : \"\"\r\n  );\r\n\r\n  const [lastSyncedValue, setLastSyncedValue] = useState<Date | undefined>(\r\n    dateValue\r\n  );\r\n\r\n  const isSameDate = (d1?: Date, d2?: Date) => {\r\n    if (!d1 && !d2) return true;\r\n    if (!d1 || !d2) return false;\r\n    return d1.getTime() === d2.getTime();\r\n  };\r\n\r\n  if (!isSameDate(dateValue, lastSyncedValue)) {\r\n    setLastSyncedValue(dateValue);\r\n    const formatted = dateValue ? format(dateValue, dateInputFormat) : \"\";\r\n    if (formatted !== inputText) {\r\n      setInputText(formatted);\r\n    }\r\n  }\r\n\r\n  const placeholder = field.placeholder || dateInputFormat.toLowerCase();\r\n\r\n  const presetsConfig = field.ui?.presets;\r\n  const presets =\r\n    presetsConfig === true\r\n      ? DEFAULT_PRESETS\r\n      : Array.isArray(presetsConfig)\r\n        ? presetsConfig\r\n        : null;\r\n\r\n  const minDate = parseToDate(field.minDate);\r\n  const maxDate = parseToDate(field.maxDate);\r\n  const disabledMatchers: Matcher[] = [];\r\n  if (minDate) disabledMatchers.push({ before: startOfDay(minDate) });\r\n  if (maxDate) disabledMatchers.push({ after: startOfDay(maxDate) });\r\n\r\n  const handleDateSelect = (date: Date | undefined) => {\r\n    if (!date) {\r\n      form.setValue(path, undefined, {\r\n        shouldDirty: true,\r\n        shouldValidate: true,\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Preserve existing time if switching dates\r\n    let nextDate = date;\r\n    if (dateValue && hasTimePicker) {\r\n      nextDate = setHours(nextDate, getHours(dateValue));\r\n      nextDate = setMinutes(nextDate, getMinutes(dateValue));\r\n      nextDate = setSeconds(nextDate, getSeconds(dateValue));\r\n    }\r\n\r\n    // Validate against min/max\r\n    if (minDate && nextDate < startOfDay(minDate)) nextDate = minDate;\r\n    if (maxDate && nextDate > startOfDay(maxDate)) nextDate = maxDate;\r\n\r\n    form.setValue(path, nextDate, {\r\n      shouldDirty: true,\r\n      shouldValidate: true,\r\n    });\r\n    if (!hasTimePicker) setIsOpen(false);\r\n  };\r\n\r\n  const handleTimeChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const timeVal = e.target.value;\r\n    if (!timeVal) return;\r\n\r\n    const [hours, minutes, seconds] = timeVal.split(\":\").map(Number);\r\n    const current = dateValue || new Date();\r\n    let next = setHours(current, hours || 0);\r\n    next = setMinutes(next, minutes || 0);\r\n    next = setSeconds(next, seconds || 0);\r\n\r\n    // Validate against min/max (optional, but good practice)\r\n    if (minDate && next < minDate) next = minDate;\r\n    if (maxDate && next > maxDate) next = maxDate;\r\n\r\n    form.setValue(path, next, { shouldDirty: true, shouldValidate: true });\r\n  };\r\n\r\n  const handleClear = (e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    form.setValue(path, undefined, {\r\n      shouldDirty: true,\r\n      shouldValidate: true,\r\n    });\r\n  };\r\n\r\n  const handlePresetClick = (preset: {\r\n    label: string;\r\n    value: Date | (() => Date);\r\n  }) => {\r\n    const date =\r\n      typeof preset.value === \"function\" ? preset.value() : preset.value;\r\n\r\n    // Preserve existing time\r\n    let nextDate = date;\r\n    if (dateValue && hasTimePicker) {\r\n      nextDate = setHours(nextDate, getHours(dateValue));\r\n      nextDate = setMinutes(nextDate, getMinutes(dateValue));\r\n      nextDate = setSeconds(nextDate, getSeconds(dateValue));\r\n    }\r\n\r\n    // Validate\r\n    if (minDate && nextDate < startOfDay(minDate)) nextDate = minDate;\r\n    if (maxDate && nextDate > startOfDay(maxDate)) nextDate = maxDate;\r\n\r\n    form.setValue(path, nextDate, {\r\n      shouldDirty: true,\r\n      shouldValidate: true,\r\n    });\r\n    if (!hasTimePicker) setIsOpen(false);\r\n  };\r\n\r\n  // Handle manual text input change\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setInputText(e.target.value);\r\n  };\r\n\r\n  // Parse and validate typed date on blur\r\n  const handleInputBlur = () => {\r\n    form.onBlur?.(path);\r\n\r\n    if (!inputText.trim()) {\r\n      // Empty input - clear the date if not required\r\n      if (!field.required) {\r\n        form.setValue(path, undefined, {\r\n          shouldDirty: true,\r\n          shouldValidate: true,\r\n        });\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Try to parse the input using the configured format\r\n    const parsedDate = parse(inputText, dateInputFormat, new Date());\r\n\r\n    if (isValid(parsedDate)) {\r\n      // Preserve existing time when updating date\r\n      let nextDate = parsedDate;\r\n      if (dateValue && hasTimePicker) {\r\n        nextDate = setHours(nextDate, getHours(dateValue));\r\n        nextDate = setMinutes(nextDate, getMinutes(dateValue));\r\n        nextDate = setSeconds(nextDate, getSeconds(dateValue));\r\n      }\r\n\r\n      // Check Min/Max\r\n      if (minDate && nextDate < startOfDay(minDate)) {\r\n        setInputText(dateValue ? format(dateValue, dateInputFormat) : \"\");\r\n        return;\r\n      }\r\n      if (maxDate && nextDate > startOfDay(maxDate)) {\r\n        setInputText(dateValue ? format(dateValue, dateInputFormat) : \"\");\r\n        return;\r\n      }\r\n\r\n      form.setValue(path, nextDate, {\r\n        shouldDirty: true,\r\n        shouldValidate: true,\r\n      });\r\n    } else {\r\n      // Invalid input - revert to previous value\r\n      setInputText(dateValue ? format(dateValue, dateInputFormat) : \"\");\r\n    }\r\n  };\r\n\r\n  const timeFormat = includeSeconds\r\n    ? use24hr\r\n      ? \"HH:mm:ss\"\r\n      : \"hh:mm:ss a\"\r\n    : use24hr\r\n      ? \"HH:mm\"\r\n      : \"hh:mm a\";\r\n\r\n  const timeValue = dateValue\r\n    ? includeSeconds\r\n      ? format(dateValue, \"HH:mm:ss\")\r\n      : format(dateValue, \"HH:mm\")\r\n    : \"\";\r\n\r\n  void timeFormat;\r\n\r\n  const timeInterval =\r\n    typeof timePickerConfig === \"object\" && timePickerConfig.interval\r\n      ? timePickerConfig.interval\r\n      : 1;\r\n  const timeStep = includeSeconds ? 1 : timeInterval * 60;\r\n\r\n  const renderInputContent = () => {\r\n    const calendarContent = (\r\n      <div className=\"flex flex-col\">\r\n        <Calendar\r\n          mode=\"single\"\r\n          selected={dateValue}\r\n          onSelect={handleDateSelect}\r\n          disabled={disabledMatchers.length ? disabledMatchers : undefined}\r\n          autoFocus={autoFocus}\r\n          className=\"w-full\"\r\n        />\r\n\r\n        {presets && presets.length > 0 && (\r\n          <div className=\"border-t px-3 py-2 flex flex-wrap gap-1.5\">\r\n            {presets.map((preset, i) => (\r\n              <InputGroupButton\r\n                key={i}\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                className=\"h-7 text-xs px-2.5 rounded-full\"\r\n                onClick={() => handlePresetClick(preset)}\r\n              >\r\n                {preset.label}\r\n              </InputGroupButton>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n\r\n    const triggerContent = (\r\n      <InputGroup\r\n        className={cn(\r\n          hasError && \"border-destructive focus-within:ring-destructive\"\r\n        )}\r\n      >\r\n        <InputGroupAddon align=\"inline-start\" className=\"pl-3\">\r\n          <Popover open={isOpen} onOpenChange={setIsOpen} modal>\r\n            <PopoverTrigger\r\n              className=\"h-6 w-6 p-0 inline-flex items-center justify-center rounded-md hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 text-muted-foreground\"\r\n              onClick={() => setIsOpen(true)}\r\n              title=\"Open calendar\"\r\n              disabled={isDisabled || isReadOnly}\r\n            >\r\n              <IconPlaceholder\r\n                lucide=\"Calendar\"\r\n                hugeicons=\"Calendar02Icon\"\r\n                tabler=\"IconCalendar\"\r\n                phosphor=\"Calendar\"\r\n                className=\"size-4\"\r\n              />\r\n            </PopoverTrigger>\r\n            <PopoverContent className=\"p-0 w-auto\" align=\"start\">\r\n              {calendarContent}\r\n            </PopoverContent>\r\n          </Popover>\r\n        </InputGroupAddon>\r\n        <InputGroupInput\r\n          id={fieldId}\r\n          value={inputText}\r\n          onChange={handleInputChange}\r\n          onBlur={handleInputBlur}\r\n          placeholder={placeholder}\r\n          disabled={isDisabled}\r\n          readOnly={isReadOnly}\r\n          autoComplete={field.autoComplete}\r\n          className=\"px-2\"\r\n          autoFocus={autoFocus}\r\n        />\r\n        {!field.required && !isDisabled && !isReadOnly && dateValue && (\r\n          <InputGroupAddon align=\"inline-end\">\r\n            <InputGroupButton\r\n              variant=\"ghost\"\r\n              size=\"icon-xs\"\r\n              onClick={handleClear}\r\n              className=\"h-8 w-8 rounded-full hover:bg-muted\"\r\n              title=\"Clear date\"\r\n            >\r\n              <IconPlaceholder\r\n                lucide=\"X\"\r\n                hugeicons=\"Cancel01Icon\"\r\n                tabler=\"IconX\"\r\n                phosphor=\"X\"\r\n                className=\"size-3.5 text-muted-foreground\"\r\n              />\r\n            </InputGroupButton>\r\n          </InputGroupAddon>\r\n        )}\r\n      </InputGroup>\r\n    );\r\n\r\n    if (!hasTimePicker) {\r\n      return triggerContent;\r\n    }\r\n\r\n    return (\r\n      <FieldGroup className=\"flex-col sm:flex-row gap-3 items-stretch\">\r\n        <div className=\"flex flex-col gap-1.5 flex-1\">\r\n          <FieldLabel\r\n            htmlFor={fieldId}\r\n            className=\"text-[10px] font-bold uppercase tracking-wider text-muted-foreground/70 px-0.5 mb-0\"\r\n          >\r\n            Date\r\n          </FieldLabel>\r\n          <div className=\"relative\">{triggerContent}</div>\r\n        </div>\r\n\r\n        <div className=\"flex flex-col gap-1.5 w-full sm:w-40\">\r\n          <FieldLabel\r\n            htmlFor={`${fieldId}-time`}\r\n            className=\"text-[10px] font-bold uppercase tracking-wider text-muted-foreground/70 px-0.5 mb-0\"\r\n          >\r\n            Time\r\n          </FieldLabel>\r\n          <InputGroup\r\n            className={cn(\r\n              hasError && \"border-destructive focus-within:ring-destructive\",\r\n              !dateValue &&\r\n                \"opacity-50 cursor-not-allowed text-muted-foreground\"\r\n            )}\r\n          >\r\n            <InputGroupAddon\r\n              align=\"inline-start\"\r\n              className=\"pl-3 pointer-events-none\"\r\n            >\r\n              <IconPlaceholder\r\n                lucide=\"Clock\"\r\n                hugeicons=\"Clock01Icon\"\r\n                tabler=\"IconClock\"\r\n                phosphor=\"Clock\"\r\n                className=\"size-4 shrink-0\"\r\n              />\r\n            </InputGroupAddon>\r\n            <InputGroupInput\r\n              id={`${fieldId}-time`}\r\n              type=\"time\"\r\n              step={timeStep}\r\n              value={timeValue}\r\n              onChange={handleTimeChange}\r\n              disabled={isDisabled || !dateValue}\r\n              className=\"px-2 focus-visible:ring-0 focus:ring-0 outline-none ring-0 appearance-none [&::-webkit-calendar-picker-indicator]:hidden [&::-webkit-calendar-picker-indicator]:appearance-none\"\r\n              placeholder=\"--:--\"\r\n            />\r\n          </InputGroup>\r\n        </div>\r\n      </FieldGroup>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Field\r\n      className={field.style?.className}\r\n      data-invalid={hasError}\r\n      data-disabled={isDisabled}\r\n      style={getFieldWidthStyle(field.style)}\r\n    >\r\n      {label && (\r\n        <FieldLabel htmlFor={fieldId} className=\"gap-1 items-baseline\">\r\n          {label}\r\n          {field.required && <span className=\"text-destructive\">*</span>}\r\n        </FieldLabel>\r\n      )}\r\n\r\n      <FieldContent>{renderInputContent()}</FieldContent>\r\n\r\n      {field.description && (\r\n        <FieldDescription id={`${fieldId}-description`}>\r\n          {field.description}\r\n        </FieldDescription>\r\n      )}\r\n\r\n      {error && <FieldError>{error}</FieldError>}\r\n    </Field>\r\n  );\r\n}\r\n\r\nconst InputSkeleton = ({ className = \"\" }: { className?: string }) => (\r\n  <div\r\n    className={cn(\r\n      \"h-8 w-full border border-input rounded-lg flex items-center gap-2 px-3 bg-muted/40\",\r\n      className\r\n    )}\r\n  >\r\n    <div className=\"size-4 rounded bg-muted-foreground/20 shrink-0\" />\r\n    <div className=\"h-4 flex-1 bg-muted-foreground/20 rounded\" />\r\n  </div>\r\n);\r\n\r\nexport function DateFieldSkeleton({\r\n  field,\r\n}: {\r\n  field: DateFieldType | DatetimeFieldType;\r\n}) {\r\n  const label = field.label !== false ? (field.label ?? field.name) : null;\r\n  const timePickerConfig =\r\n    field.type === \"datetime\"\r\n      ? (field as DatetimeFieldType).ui?.timePicker\r\n      : undefined;\r\n  const hasTimePicker = field.type === \"datetime\";\r\n  void timePickerConfig;\r\n\r\n  if (hasTimePicker) {\r\n    return (\r\n      <Field className={field.style?.className}>\r\n        {label && <div className=\"h-4 w-24 animate-pulse rounded bg-muted\" />}\r\n        <FieldContent>\r\n          <FieldGroup className=\"flex-col sm:flex-row gap-3\">\r\n            <div className=\"flex flex-col gap-1.5 flex-1\">\r\n              <div className=\"h-2.5 w-8 bg-muted rounded\" />\r\n              <InputSkeleton />\r\n            </div>\r\n            <div className=\"flex flex-col gap-1.5 w-full sm:w-40\">\r\n              <div className=\"h-2.5 w-8 bg-muted rounded\" />\r\n              <InputSkeleton />\r\n            </div>\r\n          </FieldGroup>\r\n        </FieldContent>\r\n        {field.description && (\r\n          <div className=\"h-3 w-48 animate-pulse rounded bg-muted\" />\r\n        )}\r\n      </Field>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Field className={field.style?.className}>\r\n      {label && <div className=\"h-4 w-24 animate-pulse rounded bg-muted\" />}\r\n      <FieldContent>\r\n        <InputSkeleton />\r\n      </FieldContent>\r\n      {field.description && (\r\n        <div className=\"h-3 w-48 animate-pulse rounded bg-muted\" />\r\n      )}\r\n    </Field>\r\n  );\r\n}\r\n",
      "type": "registry:component",
      "target": "components/buzzform/fields/date.tsx"
    }
  ],
  "type": "registry:ui"
}