{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "checkbox-group",
  "title": "CheckboxGroupField",
  "description": "A checkbox group field component for BuzzForm. Supports multi-select arrays, static or async options, min/max selected constraints, and default/card variants.",
  "dependencies": [
    "@buildnbuzz/buzzform"
  ],
  "registryDependencies": [
    "@buzzform/init",
    "checkbox",
    "field"
  ],
  "files": [
    {
      "path": "registry/base/fields/checkbox-group.tsx",
      "content": "\"use client\";\r\n\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport type {\r\n  CheckboxGroupField as CheckboxGroupFieldType,\r\n  SelectOption,\r\n  ValidationContext,\r\n  FormAdapter,\r\n} from \"@buildnbuzz/buzzform\";\r\nimport {\r\n  normalizeSelectOption,\r\n  getSelectOptionValue,\r\n  getSelectOptionLabel,\r\n  isSelectOptionDisabled,\r\n  getFieldWidthStyle,\r\n  getNestedValue,\r\n} from \"@buildnbuzz/buzzform\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport {\n  Field,\n  FieldDescription,\n  FieldError,\n  FieldLabel,\n} from \"@/components/ui/field\";\nimport { cn } from \"@/lib/utils\";\n\ntype OptionValue = string | number | boolean;\ntype OptionGroupVariant = \"default\" | \"card\";\ntype OptionGroupDirection = \"vertical\" | \"horizontal\";\ntype OptionGroupColumns = 1 | 2 | 3 | 4;\n\r\nexport interface CheckboxGroupFieldProps {\n  field: CheckboxGroupFieldType;\r\n  path: string;\r\n  form: FormAdapter;\r\n  autoFocus?: boolean;\r\n  formValues: Record<string, unknown>;\r\n  siblingData: Record<string, unknown>;\r\n  // Computed props\r\n  fieldId: string;\r\n  label: React.ReactNode | null;\r\n  isDisabled: boolean;\r\n  isReadOnly: boolean;\r\n  error?: string;\n}\n\nfunction getGridColumnsClass(columns: OptionGroupColumns | undefined) {\n  if (columns === 2) return \"sm:grid-cols-2\";\n  if (columns === 3) return \"sm:grid-cols-2 md:grid-cols-3\";\n  if (columns === 4) return \"sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4\";\n  return undefined;\n}\n\nfunction getOptionGroupLayoutClassName({\n  variant = \"default\",\n  direction = \"vertical\",\n  columns,\n}: {\n  variant?: OptionGroupVariant;\n  direction?: OptionGroupDirection;\n  columns?: OptionGroupColumns;\n}) {\n  const usesGridColumns = variant === \"card\" || direction === \"horizontal\";\n  const effectiveColumns = usesGridColumns ? columns : undefined;\n\n  if (!effectiveColumns || effectiveColumns === 1) {\n    if (variant === \"default\" && direction === \"horizontal\") {\n      return \"flex flex-wrap gap-x-4 gap-y-2\";\n    }\n    return \"flex flex-col gap-2\";\n  }\n\n  return cn(\"grid gap-2\", getGridColumnsClass(effectiveColumns));\n}\n\r\nfunction valueToString(value: OptionValue): string {\r\n  if (typeof value === \"boolean\") return value ? \"true\" : \"false\";\r\n  return String(value);\r\n}\r\n\r\nfunction stringToValue(\r\n  str: string,\r\n  options: SelectOption[],\r\n): OptionValue | undefined {\r\n  const option = options.find((opt) => valueToString(opt.value) === str);\r\n  return option?.value;\r\n}\r\n\r\nfunction isAsyncOptions(\r\n  options: CheckboxGroupFieldType[\"options\"],\r\n): options is (context: ValidationContext) => Promise<SelectOption[]> {\r\n  return typeof options === \"function\";\r\n}\r\n\r\nfunction useAsyncOptions(\r\n  options: CheckboxGroupFieldType[\"options\"],\r\n  dependencies: string[] | undefined,\r\n  formValues: Record<string, unknown>,\r\n  siblingData: Record<string, unknown>,\r\n  path: string,\r\n): {\r\n  resolvedOptions: SelectOption[];\r\n  isLoading: boolean;\r\n} {\r\n  const isAsync = isAsyncOptions(options);\r\n  const cacheRef = useRef<Map<string, SelectOption[]>>(new Map());\r\n\r\n  const [resolvedOptions, setResolvedOptions] = useState<SelectOption[]>(\r\n    !isAsync\r\n      ? Array.isArray(options)\r\n        ? options.map(normalizeSelectOption)\r\n        : []\r\n      : [],\r\n  );\r\n  const [isLoading, setIsLoading] = useState(isAsync);\r\n\r\n  const dependencyKey = (() => {\r\n    if (!dependencies || dependencies.length === 0) return \"static\";\r\n    const values = dependencies.map((dep) => getNestedValue(formValues, dep));\r\n    return JSON.stringify(values);\r\n  })();\r\n\r\n  useEffect(() => {\r\n    if (!isAsync) {\r\n      if (Array.isArray(options)) {\r\n        setResolvedOptions(options.map(normalizeSelectOption));\r\n      }\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    if (cacheRef.current.has(dependencyKey)) {\r\n      setResolvedOptions(cacheRef.current.get(dependencyKey)!);\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    let isMounted = true;\r\n\r\n    async function fetchOptions() {\r\n      setIsLoading(true);\r\n\r\n      try {\r\n        const context: ValidationContext = {\r\n          data: formValues,\r\n          siblingData,\r\n          path: path.split(\".\"),\r\n        };\r\n\r\n        const result = await (\r\n          options as (context: ValidationContext) => Promise<SelectOption[]>\r\n        )(context);\r\n\r\n        const normalized = result.map(normalizeSelectOption);\r\n\r\n        if (isMounted) {\r\n          cacheRef.current.set(dependencyKey, normalized);\r\n          setResolvedOptions(normalized);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Failed to fetch checkbox-group options:\", err);\r\n        if (isMounted) {\r\n          setResolvedOptions([]);\r\n        }\r\n      } finally {\r\n        if (isMounted) {\r\n          setIsLoading(false);\r\n        }\r\n      }\r\n    }\r\n\r\n    fetchOptions();\r\n\r\n    return () => {\r\n      isMounted = false;\r\n    };\r\n  }, [isAsync, options, dependencyKey, formValues, siblingData, path]);\r\n\r\n  return { resolvedOptions, isLoading };\r\n}\r\n\r\nconst cardSizeClasses = {\r\n  sm: \"p-2.5 sm:p-3\",\r\n  md: \"p-3 sm:p-4\",\r\n  lg: \"p-4 sm:p-5\",\r\n} as const;\r\n\r\nexport function CheckboxGroupField({\r\n  field,\r\n  path,\r\n  form,\r\n  autoFocus,\r\n  formValues,\r\n  siblingData,\r\n  fieldId,\r\n  label,\r\n  isDisabled,\r\n  isReadOnly,\r\n  error,\r\n}: CheckboxGroupFieldProps) {\r\n  const rawValue = form.watch(path);\r\n  const hasError = !!error;\r\n\r\n  const selectedValues = Array.isArray(rawValue)\r\n    ? (rawValue as OptionValue[]).map(valueToString)\r\n    : [];\r\n\r\n  const { resolvedOptions, isLoading } = useAsyncOptions(\r\n    field.options,\r\n    field.dependencies,\r\n    formValues,\r\n    siblingData,\r\n    path,\r\n  );\r\n\r\n  const variant = field.ui?.variant ?? \"default\";\n  const direction = field.ui?.direction ?? \"vertical\";\n  const columns = field.ui?.columns;\n  const cardSize = field.ui?.card?.size ?? \"md\";\n  const cardBordered = field.ui?.card?.bordered ?? true;\n  const maxSelected = field.maxSelected;\n\n  const isCardVariant = variant === \"card\";\n  const layoutClasses = getOptionGroupLayoutClassName({\n    variant,\n    direction,\n    columns,\n  });\n\r\n  const handleToggle = (stringValue: string, checked: boolean) => {\r\n    if (isReadOnly) return;\r\n\r\n    const hasMaxLimit = typeof maxSelected === \"number\" && maxSelected >= 0;\r\n    if (checked && hasMaxLimit && selectedValues.length >= maxSelected) {\r\n      return;\r\n    }\r\n\r\n    const currentSet = new Set(selectedValues);\r\n    if (checked) {\r\n      currentSet.add(stringValue);\r\n    } else {\r\n      currentSet.delete(stringValue);\r\n    }\r\n\r\n    const nextValues = Array.from(currentSet)\r\n      .map((value) => stringToValue(value, resolvedOptions))\r\n      .filter((value): value is OptionValue => value !== undefined);\r\n\r\n    form.setValue(path, nextValues, {\r\n      shouldDirty: true,\r\n      shouldValidate: true,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={cn(\"flex flex-col gap-2\", field.style?.className)}\r\n      data-invalid={hasError}\r\n      data-readonly={isReadOnly}\r\n      style={getFieldWidthStyle(field.style)}\r\n    >\r\n      {label && (\r\n        <FieldLabel className=\"gap-1 items-baseline\">\r\n          {field.required && <span className=\"text-destructive\">*</span>}\r\n          {label}\r\n        </FieldLabel>\r\n      )}\r\n\r\n      {field.description && (\r\n        <FieldDescription className=\"-mt-1 mb-1\" id={`${fieldId}-description`}>\r\n          {field.description}\r\n        </FieldDescription>\r\n      )}\r\n\r\n      <div\n        className={layoutClasses}\n        role=\"group\"\n        aria-describedby={\n          field.description ? `${fieldId}-description` : undefined\n        }\n      >\n        {!isLoading &&\r\n          resolvedOptions.map((opt, i) => {\r\n            const value = getSelectOptionValue(opt);\r\n            const optionLabel = getSelectOptionLabel(opt);\r\n            const normalized = normalizeSelectOption(opt);\r\n            const checked = selectedValues.includes(value);\r\n            const hasMaxLimit =\r\n              typeof maxSelected === \"number\" && maxSelected >= 0;\r\n            const isAtMaxSelection =\r\n              hasMaxLimit && selectedValues.length >= maxSelected;\r\n            const optDisabled =\r\n              isSelectOptionDisabled(opt) ||\r\n              isDisabled ||\r\n              (isAtMaxSelection && !checked);\r\n            const id = `${fieldId}-${i}`;\r\n\r\n            if (isCardVariant) {\r\n              const showDescription =\r\n                normalized.description && cardSize !== \"sm\";\r\n              const optionKey = `${value}-${i}`;\r\n\r\n              return (\r\n                <label\r\n                  key={optionKey}\r\n                  htmlFor={id}\r\n                  className={cn(\r\n                    \"cursor-pointer transition-all duration-150 rounded-lg\",\r\n                    \"flex items-start gap-3\",\r\n                    cardSizeClasses[cardSize],\r\n                    cardBordered && \"border\",\r\n                    cardBordered &&\r\n                      checked &&\r\n                      \"border-primary ring-1 ring-primary/20 bg-primary/5 dark:bg-primary/10\",\r\n                    cardBordered &&\r\n                      !checked &&\r\n                      \"border-border hover:border-foreground/20 hover:bg-accent/30\",\r\n                    !cardBordered && \"hover:bg-accent/50\",\r\n                    !cardBordered && checked && \"bg-accent\",\r\n                    optDisabled &&\r\n                      \"opacity-50 cursor-not-allowed pointer-events-none\",\r\n                  )}\r\n                  data-checked={checked}\r\n                  data-disabled={optDisabled}\r\n                >\r\n                  <Checkbox\r\n                    id={id}\r\n                    checked={checked}\r\n                    onCheckedChange={(next) =>\r\n                      handleToggle(value, next === true)\r\n                    }\r\n                    disabled={optDisabled}\r\n                    className=\"shrink-0 mt-0.5\"\r\n                    autoFocus={autoFocus && i === 0}\r\n                  />\r\n                  <div className=\"flex flex-col gap-0.5 min-w-0 flex-1\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      {normalized.icon && (\r\n                        <span className=\"shrink-0 text-muted-foreground\">\r\n                          {normalized.icon}\r\n                        </span>\r\n                      )}\r\n                      <span\r\n                        className={cn(\r\n                          \"font-medium\",\r\n                          cardSize === \"lg\" ? \"text-base\" : \"text-sm\",\r\n                        )}\r\n                      >\r\n                        {optionLabel}\r\n                      </span>\r\n                    </div>\r\n                    {showDescription && (\r\n                      <span\r\n                        className={cn(\r\n                          \"text-muted-foreground line-clamp-2\",\r\n                          cardSize === \"lg\" ? \"text-sm\" : \"text-xs\",\r\n                        )}\r\n                      >\r\n                        {normalized.description}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                </label>\r\n              );\r\n            }\r\n\r\n            return (\r\n              <Field\r\n                key={`${value}-${i}`}\r\n                orientation=\"horizontal\"\r\n                className={cn(\r\n                  \"items-center gap-2.5 space-y-0\",\r\n                  optDisabled && \"opacity-50 cursor-not-allowed\",\r\n                )}\r\n              >\r\n                <Checkbox\r\n                  id={id}\r\n                  checked={checked}\r\n                  onCheckedChange={(next) => handleToggle(value, next === true)}\r\n                  disabled={optDisabled}\r\n                  autoFocus={autoFocus && i === 0}\r\n                />\r\n                <FieldLabel\r\n                  htmlFor={id}\r\n                  className={cn(\r\n                    \"font-normal cursor-pointer m-0 flex items-center gap-2 text-sm\",\r\n                    optDisabled && \"cursor-not-allowed\",\r\n                  )}\r\n                >\r\n                  {normalized.icon && (\r\n                    <span className=\"shrink-0 text-muted-foreground\">\r\n                      {normalized.icon}\r\n                    </span>\r\n                  )}\r\n                  <span>{optionLabel}</span>\r\n                </FieldLabel>\r\n              </Field>\r\n            );\r\n          })}\r\n      </div>\r\n\r\n      {error && <FieldError>{error}</FieldError>}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function CheckboxGroupFieldSkeleton({\r\n  field,\r\n}: {\r\n  field: CheckboxGroupFieldType;\r\n}) {\r\n  const label = field.label !== false ? (field.label ?? field.name) : null;\n  const variant = field.ui?.variant ?? \"default\";\n  const direction = field.ui?.direction ?? \"vertical\";\n  const columns = field.ui?.columns;\n  const cardSize = field.ui?.card?.size ?? \"md\";\n  const cardBordered = field.ui?.card?.bordered ?? true;\n\n  const isCardVariant = variant === \"card\";\n  const optionCount = Math.min(\r\n    Array.isArray(field.options) ? field.options.length : 3,\r\n    6,\r\n  );\r\n\r\n  const layoutClasses = getOptionGroupLayoutClassName({\n    variant,\n    direction,\n    columns,\n  });\n\r\n  return (\r\n    <div className={cn(\"flex flex-col gap-2\", field.style?.className)}>\r\n      {label && <div className=\"h-4 w-32 animate-pulse rounded bg-muted\" />}\r\n      <div className={layoutClasses}>\n        {Array.from({ length: optionCount }).map((_, i) =>\r\n          isCardVariant ? (\r\n            <div\r\n              key={i}\r\n              className={cn(\r\n                \"rounded-lg border animate-pulse\",\r\n                cardBordered && \"border-border\",\r\n                cardSizeClasses[cardSize],\r\n              )}\r\n            >\r\n              <div className=\"h-4 w-3/4 rounded bg-muted\" />\r\n            </div>\r\n          ) : (\r\n            <div key={i} className=\"flex items-center gap-2.5\">\r\n              <div className=\"size-4 rounded bg-muted animate-pulse\" />\r\n              <div className=\"h-4 w-24 rounded bg-muted animate-pulse\" />\r\n            </div>\r\n          ),\r\n        )}\r\n      </div>\r\n      {field.description && (\r\n        <div className=\"h-3 w-48 animate-pulse rounded bg-muted\" />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n",
      "type": "registry:component",
      "target": "components/buzzform/fields/checkbox-group.tsx"
    }
  ],
  "type": "registry:ui"
}